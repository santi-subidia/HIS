extends ../layout

block content
  .container
    h2.mb-4 Internación por Turno

    // Filtros
    form.mb-3.d-flex.gap-3(method="GET", action="/Turno/")
      input.form-control(type="text", name="dni", placeholder="Buscar por DNI" value=(filters && filters.dni) || '')
      input.form-control(type="text", name="nombre", placeholder="Buscar por Nombre" value=(filters && filters.nombre) || '')
      input.form-control(type="date", name="fecha", placeholder="Fecha" value=(filters && filters.fecha) || '')
      button.btn.btn-primary(type="submit") Filtrar

    // Mensaje de error
    if mensaje
      .alert.alert-danger= mensaje

    // Tabla de turnos
    table.table.table-striped
      thead
        tr
          th Turno ID
          th Fecha
          th Hora
          th Paciente
          th DNI
          th Teléfono
          th Estado
          th Acciones
      tbody
        if turnos.length
          each turno in turnos
            tr
              td= turno.id
              td= turno.fecha ? turno.fecha.toISOString().slice(0,10) : '-'
              td= turno.fecha ? turno.fecha.toISOString().slice(11,16) : '-'
              td= turno.Paciente ? turno.Paciente.persona.nombre + ' ' + turno.Paciente.persona.apellido : '-'
              td= turno.Paciente ? turno.Paciente.persona.DNI : '-'
              td= turno.Paciente ? turno.Paciente.persona.telefono : '-'
              td
                if turno.estado === 'pendiente'
                  span.badge.bg-warning.text-dark Pendiente
                else if turno.estado === 'confirmado'
                  span.badge.bg-success Confirmado
                else if turno.estado === 'cancelado'
                  span.badge.bg-danger Cancelado
              td
                a.btn.btn-info.btn-sm.me-1(href=`/turno/details/${turno.id}` title="Ver detalles")
                  i.bi.bi-eye.me-1
                  | Ver
                if turno.Paciente && turno.estado === 'confirmado'
                  form(action="/internacion/create/buscar" method="POST" style="display:inline;")
                    input(type="hidden" name="dni" value=turno.Paciente.persona.DNI)
                    button.btn.btn-success.btn-sm(type="submit" title="Internar paciente")
                      i.fas.fa-bed.me-1
                      | Internar
        else
          tr
            td(colspan="8").text-center No hay turnos para mostrar.