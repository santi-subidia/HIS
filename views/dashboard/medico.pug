extends ../layout

block content
  .container-fluid.mt-4
    // Header
    .row.mb-4
      .col-md-12
        .d-flex.justify-content-between.align-items-center
          div
            h2.text-primary
              i.fas.fa-user-md.me-2
              | Dashboard M茅dico
            p.text-muted Bienvenido, #{usuario.nombre_completo}
          div
            a.btn.btn-danger(href='/logout')
              i.fas.fa-sign-out-alt.me-2
              | Cerrar Sesi贸n

    // Estad铆sticas
    .row.mb-4
      .col-md-3
        .card.border-primary.shadow-sm
          .card-body.text-center
            i.fas.fa-hospital-user.fa-3x.text-primary.mb-2
            h3.mb-0= totalInternaciones
            small.text-muted Total Internaciones
      .col-md-3
        .card.border-danger.shadow-sm
          .card-body.text-center
            i.fas.fa-exclamation-circle.fa-3x.text-danger.mb-2
            h3.mb-0= prioridadAlta
            small.text-muted Prioridad Alta
      .col-md-3
        .card.border-warning.shadow-sm
          .card-body.text-center
            i.fas.fa-exclamation-triangle.fa-3x.text-warning.mb-2
            h3.mb-0= prioridadMedia
            small.text-muted Prioridad Media
      .col-md-3
        .card.border-info.shadow-sm
          .card-body.text-center
            i.fas.fa-info-circle.fa-3x.text-info.mb-2
            h3.mb-0= prioridadBaja
            small.text-muted Prioridad Baja

    // Tabla de internaciones
    .row
      .col-md-12
        .card.shadow
          .card-header.bg-primary.text-white
            h5.mb-0
              i.fas.fa-bed.me-2
              | Internaciones Activas
          .card-body
            if internaciones.length === 0
              .alert.alert-info
                i.fas.fa-info-circle.me-2
                | No hay internaciones activas en este momento

            else
              .table-responsive
                table.table.table-hover.table-striped
                  thead.table-dark
                    tr
                      th Prioridad
                      th Paciente
                      th Ubicaci贸n
                      th Motivo
                      th Fecha Ingreso
                      th Acciones
                  tbody
                    each internacion in internaciones
                      tr
                        td
                          if internacion.prioridad === 'alta'
                            span.badge.bg-danger  Alta
                          else if internacion.prioridad === 'media'
                            span.badge.bg-warning  Media
                          else if internacion.prioridad === 'baja'
                            span.badge.bg-info  Baja
                          else
                            span.badge.bg-secondary Sin asignar
                        td
                          if internacion.PacienteSeguro
                            = internacion.PacienteSeguro.paciente.persona.apellido + ', ' + internacion.PacienteSeguro.paciente.persona.nombre
                          else
                            span.badge.bg-warning.text-dark 
                              i.fas.fa-user-injured.me-1
                              | Paciente de Emergencia
                        td
                          if internacion.Cama && internacion.Cama.Habitacion
                            = internacion.Cama.Habitacion.Ala.Sector.nombre + ' - ' + internacion.Cama.Habitacion.codigo + ' - Cama ' + internacion.Cama.numero_cama
                          else
                            span.text-muted Sin cama asignada
                        td= internacion.Motivo ? internacion.Motivo.nombre : '-'
                        td
                          small= new Date(internacion.fecha_internacion).toLocaleDateString('es-AR')
                        td
                          a.btn.btn-sm.btn-primary(href=`/internacion/details/${internacion.id}`)
                            i.fas.fa-eye.me-1
                            | Ver Detalles

    // Solicitudes de Atenci贸n Pendientes
    if solicitudesPendientes && solicitudesPendientes.length > 0
      .row.mt-4
        .col-md-12
          .card.shadow.border-warning
            .card-header.bg-warning.text-dark
              h5.mb-0
                i.fas.fa-bell.me-2
                | Solicitudes de Atenci贸n Pendientes
                span.badge.bg-danger.ms-2 #{solicitudesPendientes.length}
            .card-body
              .table-responsive
                table.table.table-hover.table-bordered
                  thead.table-warning
                    tr
                      th Fecha
                      th Paciente
                      th Ubicaci贸n
                      th Motivo
                      th Enfermero
                      th Acciones
                  tbody
                    each solicitud in solicitudesPendientes
                      tr
                        td
                          small= new Date(solicitud.fecha_solicitud).toLocaleString('es-AR')
                        td
                          if solicitud.Internacion.PacienteSeguro.isDesconocido
                            span.badge.bg-warning.text-dark Paciente No Identificado
                          else
                            = solicitud.Internacion.PacienteSeguro.paciente.persona.apellido + ', ' + solicitud.Internacion.PacienteSeguro.paciente.persona.nombre
                        td
                          if solicitud.Internacion.Cama && solicitud.Internacion.Cama.Habitacion
                            = solicitud.Internacion.Cama.Habitacion.codigo + ' - Cama ' + solicitud.Internacion.Cama.numero_cama
                          else
                            span.text-muted Sin cama
                        td
                          strong.text-danger= solicitud.motivo
                          br
                          small.text-muted= solicitud.descripcion.substring(0, 60) + '...'
                        td
                          small= solicitud.Enfermero.persona.apellido + ', ' + solicitud.Enfermero.persona.nombre
                        td.text-center
                          .btn-group(role="group")
                            a.btn.btn-sm.btn-success(href=`/solicitudes-atencion/atender/${solicitud.id_solicitud_atencion || solicitud.id}`)
                              i.fas.fa-check.me-1
                              | Atender
                            a.btn.btn-sm.btn-info(href=`/internacion/details/${solicitud.Internacion.id}`)
                              i.fas.fa-eye.me-1
                              | Ver
